<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OneShot Dataset Prep</title>
    <link rel="stylesheet" href="/static/tailwind.min.css">
    <style>
        body {
            background: #0d0d0d;
            color: #e0e0e0;
            font-family: 'Roboto', sans-serif;
        }
        .glitch-edge::before,
        .glitch-edge::after {
            content: '';
            position: fixed;
            top: 0;
            bottom: 0;
            width: 8px;
            background: repeating-linear-gradient(180deg, rgba(0,255,255,0.4) 0, rgba(255,0,255,0.4) 2px, rgba(0,255,255,0.4) 4px);
            pointer-events: none;
            z-index: 50;
            animation: glitch 1s infinite linear;
        }
        .glitch-edge::before { left: 0; }
        .glitch-edge::after { right: 0; }
        @keyframes glitch {
            0%,100%{transform:translateX(0)}
            20%{transform:translateX(-2px)}
            40%{transform:translateX(2px)}
            60%{transform:translateX(-2px)}
            80%{transform:translateX(2px)}
        }
    </style>
</head>
<body class="glitch-edge text-center p-8 overflow-x-hidden">
    <h1 class="text-4xl font-bold mb-8 text-teal-400 tracking-wide">OneShot Dataset Prep</h1>
    {% if current_user.is_authenticated %}
    <p class="mb-4">Logged in as {{ current_user.username }} |
    {% if current_user.is_admin %}
    <a class="text-teal-300" href="{{ url_for('admin_users') }}">User Admin</a> |
    {% endif %}
    <a class="text-teal-300" href="{{ url_for('logout') }}">Logout</a></p>
    {% else %}
    <p class="mb-4"><a class="text-teal-300" href="{{ url_for('login') }}">Login</a>{% if registration_enabled %} or <a class="text-teal-300" href="{{ url_for('register') }}">Register</a>{% endif %}</p>
    {% endif %}
    <div class="flex flex-col md:flex-row justify-center md:space-x-8 space-y-8 md:space-y-0">
        <div>
            <h2 class="text-2xl font-semibold mb-4 text-pink-400">Archive</h2>
            <table class="table-auto border-collapse bg-gray-800 bg-opacity-50 rounded">
                <thead>
                    <tr><th class="px-4 py-2 border border-gray-700">Dataset</th></tr>
                </thead>
                <tbody>
                    {% for ds in datasets %}
                    <tr>
                        <td class="border border-gray-700 px-4 py-2 text-left">
                            <a href="{{ url_for('download', filename=ds.filename) }}" class="text-teal-300 hover:underline">{{ ds.filename }}</a>
                            {% if ds.owner_id == current_user.id %}
                            <form action="{{ url_for('share', dataset_id=ds.id) }}" method="POST" class="mt-2">
                                <input type="text" name="username" placeholder="Share with user" class="text-gray-900 p-1" required>
                                <button type="submit" class="bg-teal-600 text-white px-2 py-1 rounded">Share</button>
                            </form>
                            <form action="{{ url_for('delete_dataset', dataset_id=ds.id) }}" method="POST" class="mt-2">
                                <button type="submit" class="bg-red-600 text-white px-2 py-1 rounded">Delete</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr><td class="border border-gray-700 px-4 py-2">No datasets yet</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <form id="upload-form" action="/upload" method="POST" enctype="multipart/form-data" class="bg-gray-800 bg-opacity-50 p-6 rounded shadow-lg">
            <div id="drop-area" class="mb-4 border-2 border-dashed border-gray-600 p-6 rounded cursor-pointer text-gray-400">
                Drop image here or click to select
                <input id="file-input" type="file" name="image" accept="image/*" required class="hidden">
            </div>
        </form>
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('upload-form');
            const input = document.getElementById('file-input');
            const drop = document.getElementById('drop-area');

            ['dragenter','dragover'].forEach(evt => {
                drop.addEventListener(evt, e => {
                    e.preventDefault();
                    drop.classList.add('border-pink-500');
                });
            });
            ['dragleave','drop'].forEach(evt => {
                drop.addEventListener(evt, e => {
                    e.preventDefault();
                    drop.classList.remove('border-pink-500');
                });
            });

            drop.addEventListener('drop', e => {
                if (e.dataTransfer.files && e.dataTransfer.files.length > 0) {
                    input.files = e.dataTransfer.files;
                    form.submit();
                }
            });

            drop.addEventListener('click', () => input.click());

            input.addEventListener('change', () => {
                if (input.files.length) {
                    form.submit();
                }
            });
        });
        </script>
    </div>
</body>
</html>
